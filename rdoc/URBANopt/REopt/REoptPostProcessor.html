<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class URBANopt::REopt::REoptPostProcessor - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<link href="../../custom_rdoc_styles.css" rel="stylesheet">





<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-output_exists">#output_exists</a>
    
    <li ><a href="#method-i-run_feature_report">#run_feature_report</a>
    
    <li ><a href="#method-i-run_feature_reports">#run_feature_reports</a>
    
    <li ><a href="#method-i-run_scenario_report">#run_scenario_report</a>
    
    <li ><a href="#method-i-run_scenario_report_features">#run_scenario_report_features</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-URBANopt::REopt::REoptPostProcessor">
  <h1 id="class-URBANopt::REopt::REoptPostProcessor" class="class">
    class URBANopt::REopt::REoptPostProcessor
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-feature_reports_reopt_default_assumption_hashes" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">feature_reports_reopt_default_assumption_hashes</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-feature_reports_reopt_default_output_files" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">feature_reports_reopt_default_output_files</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-feature_reports_timeseries_default_output_files" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">feature_reports_timeseries_default_output_files</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-scenario_reopt_default_assumptions_hash" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">scenario_reopt_default_assumptions_hash</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-scenario_reopt_default_output_file" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">scenario_reopt_default_output_file</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-scenario_timeseries_default_output_file" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">scenario_timeseries_default_output_file</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(scenario_report, scenario_reopt_assumptions_file = nil, reopt_feature_assumptions = [], nrel_developer_key = nil, localhost = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>REoptPostProcessor updates a ScenarioReport or FeatureReport based on REopt Lite optimization response.</p>

<p>[<em>parameters:</em>]</p>
<ul><li>
<p><code>scenario_report</code> - <em>ScenarioReport</em> - Optional. A scenario report that has been returned from the URBANopt::Reporting::ScenarioDefaultPostProcessor - used in creating default output file names in REopt Lite optimizations.</p>
</li><li>
<p><code>scenario_reopt_assumptions_file</code> - <em>String</em> - Optional. JSON file formatted for a REopt Lite analysis containing custom input parameters for optimizations at the <a href="../Scenario.html"><code>Scenario</code></a> Report level</p>
</li><li>
<p><code>reopt_feature_assumptions</code> - <em>Array</em> - Optional. A list of JSON file formatted for a REopt Lite analysis containing custom input parameters for optimizations at the Feature Report level. The order and number of files must match the Feature Reports in the scenario_report input.</p>
</li><li>
<p><code>use_localhost</code> - <em>Bool</em> - If this is true, requests will be sent to a version of the REopt Lite API running on localhost. Default is false, such that the production version of REopt Lite is accessed.</p>
</li><li>
<p><code>nrel_developer_key</code> - <em>String</em> - API used to access the REopt Lite APi. Required only if <code>localhost</code> is false. Obtain from <a href="https://developer.nrel.gov/signup">developer.nrel.gov/signup</a>/</p>
</li></ul>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/urbanopt/reopt/reopt_post_processor.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">scenario_report</span>, <span class="ruby-identifier">scenario_reopt_assumptions_file</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">reopt_feature_assumptions</span> = [], <span class="ruby-identifier">nrel_developer_key</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">localhost</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-comment"># initialize @@logger</span>
  <span class="ruby-identifier">@@logger</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span>.<span class="ruby-identifier">reopt_logger</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">reopt_feature_assumptions</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">reopt_feature_assumptions</span> = []
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@nrel_developer_key</span> = <span class="ruby-identifier">nrel_developer_key</span>
  <span class="ruby-ivar">@localhost</span> = <span class="ruby-identifier">localhost</span>
  <span class="ruby-ivar">@reopt_base_post</span> = { <span class="ruby-value">Scenario:</span> { <span class="ruby-value">Site:</span> { <span class="ruby-value">ElectricTariff:</span> {}, <span class="ruby-value">LoadProfile:</span> {}, <span class="ruby-value">Wind:</span> { <span class="ruby-value">max_kw:</span> <span class="ruby-value">0</span> } } } }

  <span class="ruby-ivar">@scenario_reopt_default_output_file</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@scenario_timeseries_default_output_file</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@scenario_reopt_default_assumptions_hash</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@feature_reports_reopt_default_assumption_hashes</span> = []
  <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span> = []
  <span class="ruby-ivar">@feature_reports_timeseries_default_output_files</span> = []

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scenario_report</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@scenario_report</span> = <span class="ruby-identifier">scenario_report</span>

    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Dir</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@scenario_report</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-string">&#39;reopt&#39;</span>))
      <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@scenario_report</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-string">&#39;reopt&#39;</span>))
      <span class="ruby-identifier">@@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Created directory: #{File.join(@scenario_report.directory_name, &#39;reopt&#39;)}&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@scenario_reopt_default_output_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@scenario_report</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-node">&quot;reopt/scenario_report_#{@scenario_report.id}_reopt_run.json&quot;</span>)
    <span class="ruby-ivar">@scenario_timeseries_default_output_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@scenario_report</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-node">&quot;scenario_report_#{@scenario_report.id}_timeseries.csv&quot;</span>)

    <span class="ruby-ivar">@scenario_report</span>.<span class="ruby-identifier">feature_reports</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fr</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Dir</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fr</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-string">&#39;reopt&#39;</span>))
        <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fr</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-string">&#39;reopt&#39;</span>))
        <span class="ruby-identifier">@@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Created directory: #{File.join(fr.directory_name, &#39;reopt&#39;)}&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fr</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-node">&quot;reopt/feature_report_#{fr.id}_reopt_run.json&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@scenario_report</span>.<span class="ruby-identifier">feature_reports</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fr</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@feature_reports_timeseries_default_output_files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fr</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-node">&quot;feature_report_#{fr.id}_timeseries.csv&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scenario_reopt_assumptions_file</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@scenario_reopt_assumptions_file</span> = <span class="ruby-identifier">scenario_reopt_assumptions_file</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">scenario_reopt_assumptions_file</span>, <span class="ruby-string">&#39;r&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@scenario_reopt_default_assumptions_hash</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>, <span class="ruby-value">symbolize_names:</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reopt_feature_assumptions</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@reopt_feature_assumptions</span> = <span class="ruby-identifier">reopt_feature_assumptions</span>
    <span class="ruby-identifier">reopt_feature_assumptions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@feature_reports_reopt_default_assumption_hashes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;r&#39;</span>).<span class="ruby-identifier">read</span>, <span class="ruby-value">symbolize_names:</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-output_exists" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output_exists</span><span
            class="method-args">(output_file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks whether a feature has already been run by determining if output files already exists (for rate limit issues and larger projects)</p>

<p>[<em>parameters:</em>]</p>
<ul><li>
<p><code>output_file</code> - <em>Array</em> - Optional. An array of paths to files at which REpopt Lite responses will be saved. The number and order of the paths should match the array in ScenarioReport.feature_reports. [<em>return:</em>] <em>Boolean</em> - Returns true if file or nonempty directory exist</p>
</li></ul>
          
          

          
          <div class="method-source-code" id="output_exists-source">
            <pre><span class="ruby-comment"># File lib/urbanopt/reopt/reopt_post_processor.rb, line 290</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">output_exists</span>(<span class="ruby-identifier">output_file</span>)
  <span class="ruby-identifier">res</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">output_file</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">empty?</span>(<span class="ruby-identifier">output_file</span>)
    <span class="ruby-identifier">res</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">output_file</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-run_feature_report" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_feature_report</span><span
            class="method-args">(feature_report:, reopt_assumptions_hash: nil, reopt_output_file: nil, timeseries_csv_path: nil, save_name: nil, run_resilience: true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates a FeatureReport based on an optional set of REopt Lite optimization assumptions.</p>

<p>[<em>parameters:</em>]</p>
<ul><li>
<p><code>feature_report</code> - <em>URBANopt::Reporting::DefaultReports::FeatureReport</em> - FeatureReport which will be used in creating and then updated by a REopt Lite opimization response.</p>
</li><li>
<p><code>reopt_assumptions_hash</code> - <em>Hash</em> - Optional. A REopt Lite formatted hash containing default parameters (i.e. utility rate, escalation rate) which will be updated by the FeatureReport (i.e. location, roof availability)</p>
</li><li>
<p><code>reopt_output_file</code> - <em>String</em> - Optional. Path to a file at which REpopt Lite responses will be saved.</p>
</li><li>
<p><code>timeseries_csv_path</code> - <em>String</em> - Optional. Path to a file at which the new timeseries CSV for the FeatureReport will be saved.</p>
</li></ul>

<p>[<em>return:</em>] <em>URBANopt::Reporting::DefaultReports::FeatureReport</em> - Returns an updated FeatureReport</p>
          
          

          
          <div class="method-source-code" id="run_feature_report-source">
            <pre><span class="ruby-comment"># File lib/urbanopt/reopt/reopt_post_processor.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run_feature_report</span>(<span class="ruby-value">feature_report:</span>, <span class="ruby-value">reopt_assumptions_hash:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">reopt_output_file:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">timeseries_csv_path:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">save_name:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">run_resilience:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">api</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REoptLiteAPI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@nrel_developer_key</span>, <span class="ruby-ivar">@localhost</span>)
  <span class="ruby-identifier">adapter</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">FeatureReportAdapter</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">reopt_input</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">reopt_json_from_feature_report</span>(<span class="ruby-identifier">feature_report</span>, <span class="ruby-identifier">reopt_assumptions_hash</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">reopt_output_file</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">reopt_output_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">feature_report</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-string">&#39;reopt&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">reopt_output</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">reopt_request</span>(<span class="ruby-identifier">reopt_input</span>, <span class="ruby-identifier">reopt_output_file</span>)
  <span class="ruby-identifier">print</span>(<span class="ruby-node">&quot;REOPT OUTPUT FILE: #{reopt_output_file}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">run_resilience</span>
    <span class="ruby-identifier">run_uuid</span> = <span class="ruby-identifier">reopt_output</span>[<span class="ruby-string">&#39;outputs&#39;</span>][<span class="ruby-string">&#39;Scenario&#39;</span>][<span class="ruby-string">&#39;run_uuid&#39;</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">reopt_output_file</span>
      <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">resilience_request</span>(<span class="ruby-identifier">run_uuid</span>, <span class="ruby-identifier">reopt_output_file</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">resilience_request</span>(<span class="ruby-identifier">run_uuid</span>, <span class="ruby-identifier">reopt_output_file</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-string">&#39;.json&#39;</span>, <span class="ruby-string">&#39;_resilience.json&#39;</span>))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">update_feature_report</span>(<span class="ruby-identifier">feature_report</span>, <span class="ruby-identifier">reopt_output</span>, <span class="ruby-identifier">timeseries_csv_path</span>, <span class="ruby-identifier">resilience_stats</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">save_name</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">save</span> <span class="ruby-identifier">save_name</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-run_feature_reports" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_feature_reports</span><span
            class="method-args">(feature_reports:, reopt_assumptions_hashes: [], reopt_output_files: [], timeseries_csv_paths: [], save_names: nil, run_resilience: true, keep_existing_output: false, groundmount_photovoltaic: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates a set of FeatureReports based on an optional set of REopt Lite optimization assumptions.</p>

<p>[<em>parameters:</em>]</p>
<ul><li>
<p><code>feature_reports</code> - <em>Array</em> - An array of <em>URBANopt::Reporting::DefaultReports::FeatureReport</em> objetcs which will each be used to create (and are subsquently updated by) a REopt Lite opimization response.</p>
</li><li>
<p><code>reopt_assumptions_hashes</code> - <em>Array</em> - Optional. An array of REopt Lite formatted hashes containing default parameters (i.e. utility rate, escalation rate) which will be updated by the ScenarioReport (i.e. location, roof availability). The number and order of the hashes should match the feature_reports array.</p>
</li><li>
<p><code>reopt_output_files</code> - <em>Array</em> - Optional. A array of paths to files at which REpopt Lite responses will be saved. The number and order of the paths should match the feature_reports array.</p>
</li><li>
<p><code>timeseries_csv_path</code> - <em>Array</em> - Optional. A array of paths to files at which the new timeseries CSV for the FeatureReports will be saved. The number and order of the paths should match the feature_reports array.</p>
</li></ul>

<p>[<em>return:</em>] <em>Array</em> Returns an array of updated <em>URBANopt::Scenario::DefaultReports::FeatureReport</em> objects</p>
          
          

          
          <div class="method-source-code" id="run_feature_reports-source">
            <pre><span class="ruby-comment"># File lib/urbanopt/reopt/reopt_post_processor.rb, line 218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run_feature_reports</span>(<span class="ruby-value">feature_reports:</span>, <span class="ruby-value">reopt_assumptions_hashes:</span> [], <span class="ruby-value">reopt_output_files:</span> [], <span class="ruby-value">timeseries_csv_paths:</span> [], <span class="ruby-value">save_names:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">run_resilience:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">keep_existing_output:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">groundmount_photovoltaic:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reopt_assumptions_hashes</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@feature_reports_reopt_default_assumption_hashes</span> = <span class="ruby-identifier">reopt_assumptions_hashes</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reopt_output_files</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span> = <span class="ruby-identifier">reopt_output_files</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">timeseries_csv_paths</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@feature_reports_timeseries_default_output_files</span> = <span class="ruby-identifier">timeseries_csv_paths</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">feature_reports</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fr</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fr</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-node">&quot;reopt/feature_report_#{fr.id}_reopt_run.json&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@feature_reports_timeseries_default_output_files</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">feature_reports</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fr</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@feature_reports_timeseries_default_output_files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fr</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-node">&quot;feature_report_#{fr.id}_timeseries.csv&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">api</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REoptLiteAPI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@nrel_developer_key</span>, <span class="ruby-ivar">@localhost</span>)
  <span class="ruby-identifier">feature_adapter</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">FeatureReportAdapter</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">new_feature_reports</span> = []
  <span class="ruby-identifier">feature_reports</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">feature_report</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># check if we should rerun</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">keep_existing_output</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">output_exists</span>(<span class="ruby-ivar">@feature_reports_reopt_default_output_files</span>[<span class="ruby-identifier">idx</span>]))
      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">reopt_input</span> = <span class="ruby-identifier">feature_adapter</span>.<span class="ruby-identifier">reopt_json_from_feature_report</span>(<span class="ruby-identifier">feature_report</span>, <span class="ruby-ivar">@feature_reports_reopt_default_assumption_hashes</span>[<span class="ruby-identifier">idx</span>], <span class="ruby-identifier">groundmount_photovoltaic</span>)
        <span class="ruby-identifier">reopt_output</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">reopt_request</span>(<span class="ruby-identifier">reopt_input</span>, <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span>[<span class="ruby-identifier">idx</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">run_resilience</span>
          <span class="ruby-identifier">run_uuid</span> = <span class="ruby-identifier">reopt_output</span>[<span class="ruby-string">&#39;outputs&#39;</span>][<span class="ruby-string">&#39;Scenario&#39;</span>][<span class="ruby-string">&#39;run_uuid&#39;</span>]
          <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span>[<span class="ruby-identifier">idx</span>]
            <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">resilience_request</span>(<span class="ruby-identifier">run_uuid</span>, <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span>[<span class="ruby-identifier">idx</span>])
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">resilience_request</span>(<span class="ruby-identifier">run_uuid</span>, <span class="ruby-ivar">@feature_reports_reopt_default_output_files</span>[<span class="ruby-identifier">idx</span>].<span class="ruby-identifier">sub!</span>(<span class="ruby-string">&#39;.json&#39;</span>, <span class="ruby-string">&#39;_resilience.json&#39;</span>))
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">new_feature_report</span> = <span class="ruby-identifier">feature_adapter</span>.<span class="ruby-identifier">update_feature_report</span>(<span class="ruby-identifier">feature_report</span>, <span class="ruby-identifier">reopt_output</span>, <span class="ruby-ivar">@feature_reports_timeseries_default_output_files</span>[<span class="ruby-identifier">idx</span>], <span class="ruby-identifier">resilience_stats</span>)
        <span class="ruby-identifier">new_feature_reports</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">new_feature_report</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">save_names</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">save_names</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">feature_reports</span>.<span class="ruby-identifier">length</span>
            <span class="ruby-identifier">new_feature_report</span>.<span class="ruby-identifier">save</span> <span class="ruby-identifier">save_names</span>[<span class="ruby-identifier">idx</span>]
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">warn</span> <span class="ruby-string">&#39;Could not save feature reports - the number of save names provided did not match the number of feature reports&#39;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">@@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Could not optimize Feature Report #{feature_report.name} #{feature_report.id}&quot;</span>)
        <span class="ruby-identifier">@@logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;ERROR: #{e}&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">@@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-string">&#39;Output file already exists...skipping&#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_feature_reports</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-run_scenario_report" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_scenario_report</span><span
            class="method-args">(scenario_report:, reopt_assumptions_hash: nil, reopt_output_file: nil, timeseries_csv_path: nil, save_name: nil, run_resilience: true, community_photovoltaic: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates a ScenarioReport based on an optional set of REopt Lite optimization assumptions.</p>

<p>[<em>parameters:</em>]</p>
<ul><li>
<p><code>feature_report</code> - <em>URBANopt::Reporting::DefaultReports::ScenarioReport</em> - ScenarioReport which will be used in creating and then updated by a REopt Lite opimization response.</p>
</li><li>
<p><code>reopt_assumptions_hash</code> - <em>Hash</em> - Optional. A REopt Lite formatted hash containing default parameters (i.e. utility rate, escalation rate) which will be updated by the ScenarioReport (i.e. location, roof availability)</p>
</li><li>
<p><code>reopt_output_file</code> - <em>String</em> - Optional. Path to a file at which REpopt Lite responses will be saved.</p>
</li><li>
<p><code>timeseries_csv_path</code> - <em>String</em> - Optional. Path to a file at which the new timeseries CSV for the ScenarioReport will be saved.</p>
</li></ul>

<p>[<em>return:</em>] <em>URBANopt::Scenario::DefaultReports::ScenarioReport</em> Returns an updated ScenarioReport</p>
          
          

          
          <div class="method-source-code" id="run_scenario_report-source">
            <pre><span class="ruby-comment"># File lib/urbanopt/reopt/reopt_post_processor.rb, line 162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run_scenario_report</span>(<span class="ruby-value">scenario_report:</span>, <span class="ruby-value">reopt_assumptions_hash:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">reopt_output_file:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">timeseries_csv_path:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">save_name:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">run_resilience:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">community_photovoltaic:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;run scenario report&quot;</span>
  <span class="ruby-ivar">@save_assumptions_filepath</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reopt_assumptions_hash</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@scenario_reopt_default_assumptions_hash</span> = <span class="ruby-identifier">reopt_assumptions_hash</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@save_assumptions_filepath</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reopt_output_file</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@scenario_reopt_default_output_file</span> = <span class="ruby-identifier">reopt_output_file</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">timeseries_csv_path</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@scenario_timeseries_default_output_file</span> = <span class="ruby-identifier">timeseries_csv_path</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">api</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REoptLiteAPI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@nrel_developer_key</span>, <span class="ruby-ivar">@localhost</span>)
  <span class="ruby-identifier">adapter</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">ScenarioReportAdapter</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">reopt_input</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">reopt_json_from_scenario_report</span>(<span class="ruby-identifier">scenario_report</span>, <span class="ruby-ivar">@scenario_reopt_default_assumptions_hash</span>, <span class="ruby-identifier">community_photovoltaic</span>)

  <span class="ruby-identifier">reopt_output</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">reopt_request</span>(<span class="ruby-identifier">reopt_input</span>, <span class="ruby-ivar">@scenario_reopt_default_output_file</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">run_resilience</span>
    <span class="ruby-identifier">run_uuid</span> = <span class="ruby-identifier">reopt_output</span>[<span class="ruby-string">&#39;outputs&#39;</span>][<span class="ruby-string">&#39;Scenario&#39;</span>][<span class="ruby-string">&#39;run_uuid&#39;</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-ivar">@scenario_reopt_default_output_file</span>
      <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">resilience_request</span>(<span class="ruby-identifier">run_uuid</span>, <span class="ruby-ivar">@scenario_reopt_default_output_file</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-identifier">api</span>.<span class="ruby-identifier">resilience_request</span>(<span class="ruby-identifier">run_uuid</span>, <span class="ruby-ivar">@scenario_reopt_default_output_file</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-string">&#39;.json&#39;</span>, <span class="ruby-string">&#39;_resilience.json&#39;</span>))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">resilience_stats</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">update_scenario_report</span>(<span class="ruby-identifier">scenario_report</span>, <span class="ruby-identifier">reopt_output</span>, <span class="ruby-ivar">@scenario_timeseries_default_output_file</span>, <span class="ruby-identifier">resilience_stats</span>)
  <span class="ruby-comment"># can you save the assumptions file path that was used?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@save_assumptions_filepath</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@scenario_reopt_assumptions_file</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">distributed_generation</span>.<span class="ruby-identifier">reopt_assumptions_file_path</span> = <span class="ruby-ivar">@scenario_reopt_assumptions_file</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">save_name</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment"># don&#39;t save individual feature reports when doing the scenario optimization!</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">save</span>(<span class="ruby-identifier">save_name</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-run_scenario_report_features" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_scenario_report_features</span><span
            class="method-args">(scenario_report:, reopt_assumptions_hashes: [], reopt_output_files: [], feature_report_timeseries_csv_paths: [], save_names_feature_reports: nil, save_name_scenario_report: nil, run_resilience: true, keep_existing_output: false, groundmount_photovoltaic: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates a ScenarioReport based on an optional set of REopt Lite optimization assumptions.</p>

<p>[<em>parameters:</em>]</p>
<ul><li>
<p><code>scenario_report</code> - <em>Array</em> - A <em>URBANopt::Reporting::DefaultReports::ScenarioReport</em> which will each be used to create (and is subsquently updated by) REopt Lite opimization responses for each of its FeatureReports.</p>
</li><li>
<p><code>reopt_assumptions_hashes</code> - <em>Array</em> - Optional. An array of REopt Lite formatted hashes containing default parameters (i.e. utility rate, escalation rate) which will be updated by the ScenarioReport (i.e. location, roof availability). The number and order of the hashes should match the array in ScenarioReport.feature_reports.</p>
</li><li>
<p><code>reopt_output_files</code> - <em>Array</em> - Optional. An array of paths to files at which REpopt Lite responses will be saved. The number and order of the paths should match the array in ScenarioReport.feature_reports.</p>
</li><li>
<p><code>feature_report_timeseries_csv_paths</code> - <em>Array</em> - Optional. An array of paths to files at which the new timeseries CSV for the FeatureReports will be saved. The number and order of the paths should match the array in ScenarioReport.feature_reports.</p>
</li></ul>

<p>[<em>return:</em>] <em>URBANopt::Scenario::DefaultReports::ScenarioReport</em> - Returns an updated ScenarioReport</p>
          
          

          
          <div class="method-source-code" id="run_scenario_report_features-source">
            <pre><span class="ruby-comment"># File lib/urbanopt/reopt/reopt_post_processor.rb, line 312</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run_scenario_report_features</span>(<span class="ruby-value">scenario_report:</span>, <span class="ruby-value">reopt_assumptions_hashes:</span> [], <span class="ruby-value">reopt_output_files:</span> [], <span class="ruby-value">feature_report_timeseries_csv_paths:</span> [], <span class="ruby-value">save_names_feature_reports:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">save_name_scenario_report:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">run_resilience:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">keep_existing_output:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">groundmount_photovoltaic:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">new_feature_reports</span> = <span class="ruby-identifier">run_feature_reports</span>(<span class="ruby-value">feature_reports:</span> <span class="ruby-identifier">scenario_report</span>.<span class="ruby-identifier">feature_reports</span>, <span class="ruby-value">reopt_assumptions_hashes:</span> <span class="ruby-identifier">reopt_assumptions_hashes</span>, <span class="ruby-value">reopt_output_files:</span> <span class="ruby-identifier">reopt_output_files</span>, <span class="ruby-value">timeseries_csv_paths:</span> <span class="ruby-identifier">feature_report_timeseries_csv_paths</span>, <span class="ruby-value">save_names:</span> <span class="ruby-identifier">save_names_feature_reports</span>, <span class="ruby-value">run_resilience:</span> <span class="ruby-identifier">run_resilience</span>, <span class="ruby-value">keep_existing_output:</span> <span class="ruby-identifier">keep_existing_output</span>, <span class="ruby-value">groundmount_photovoltaic:</span> <span class="ruby-identifier">groundmount_photovoltaic</span>)

  <span class="ruby-comment"># only do this if you have run feature reports</span>
  <span class="ruby-identifier">new_scenario_report</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">Reporting</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultReports</span><span class="ruby-operator">::</span><span class="ruby-constant">ScenarioReport</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_feature_reports</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-identifier">new_scenario_report</span>.<span class="ruby-identifier">id</span> = <span class="ruby-identifier">scenario_report</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">new_scenario_report</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">scenario_report</span>.<span class="ruby-identifier">name</span>
    <span class="ruby-identifier">new_scenario_report</span>.<span class="ruby-identifier">directory_name</span> = <span class="ruby-identifier">scenario_report</span>.<span class="ruby-identifier">directory_name</span>

    <span class="ruby-identifier">timeseries_hash</span> = { <span class="ruby-value">column_names:</span> <span class="ruby-identifier">scenario_report</span>.<span class="ruby-identifier">timeseries_csv</span>.<span class="ruby-identifier">column_names</span> }
    <span class="ruby-identifier">new_scenario_report</span>.<span class="ruby-identifier">timeseries_csv</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">Reporting</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultReports</span><span class="ruby-operator">::</span><span class="ruby-constant">TimeseriesCSV</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">timeseries_hash</span>)

    <span class="ruby-identifier">new_feature_reports</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">feature_report</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">new_scenario_report</span>.<span class="ruby-identifier">add_feature_report</span>(<span class="ruby-identifier">feature_report</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">save_name_scenario_report</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">new_scenario_report</span>.<span class="ruby-identifier">save</span> <span class="ruby-identifier">save_name_scenario_report</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_scenario_report</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.2.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

