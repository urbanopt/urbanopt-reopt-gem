<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">
<link href="./custom_rdoc_styles.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>


    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./RDOC_MAIN_md.html">RDOC_MAIN</a>
  
    <li><a href="./lib/urbanopt/reopt/reopt_schema/reopt_input_schema_json.html">reopt_input_schema.json</a>
  
    <li><a href="./lib/urbanopt/reopt/reopt_schema/reopt_output_schema_json.html">reopt_output_schema.json</a>
  
  </ul>
</div>

    <div id="classindex-section" class="nav-section">
  <h3>Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./URBANopt.html">URBANopt</a>
  
    <li><a href="./URBANopt/REopt.html">URBANopt::REopt</a>
  
    <li><a href="./URBANopt/REopt/FeatureReportAdapter.html">URBANopt::REopt::FeatureReportAdapter</a>
  
    <li><a href="./URBANopt/REopt/REoptLiteAPI.html">URBANopt::REopt::REoptLiteAPI</a>
  
    <li><a href="./URBANopt/REopt/REoptPostProcessor.html">URBANopt::REopt::REoptPostProcessor</a>
  
    <li><a href="./URBANopt/REopt/ScenarioReportAdapter.html">URBANopt::REopt::ScenarioReportAdapter</a>
  
    <li><a href="./URBANopt/Scenario.html">URBANopt::Scenario</a>
  
    <li><a href="./URBANopt/Scenario/REoptScenarioCSV.html">URBANopt::Scenario::REoptScenarioCSV</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main">


<h1 id="label-URBANopt+REopt+Gem"><a href="URBANopt.html"><code>URBANopt</code></a> REopt Gem<span><a href="#label-URBANopt+REopt+Gem">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The <strong>URBANopt REopt Gem</strong> extends <strong>URBANopt::Scenario::DefaultReports::ScenarioReport</strong> and <strong>URBANopt::Scenario::DefaultReports::FeatureReport</strong> with the ability to derive cost-optimal distributed energy resource (DER) technology sizes and annual dispatch strageties via the <a href="https://reopt.nrel.gov/tool">REopt Lite</a> decision support platform. REopt Lite is a technoeconomic model which leverages mixed integer linear programming to identify the cost-optimal sizing of solar PV, Wind, Storage and/or diesel generation given an electric load profile, a utility rate tariff and other technoeconomic parameters. See &lt;StaticLink target=“_blank” href=“<a href="https://developer.nrel.gov/docs/energy-optimization/reopt-v1/">https://developer.nrel.gov/docs/energy-optimization/reopt-v1/</StaticLink">developer.nrel.gov/docs/energy-optimization/reopt-v1/”>https://developer.nrel.gov/docs/energy-optimization/reopt-v1/</StaticLink</a>&gt; for more detailed information on input parameters and default assumptions.</p>

<p>See the &lt;StaticLink target=“_blank” href=“<a href="https://github.com/TK-23/urbanopt-example-geojson-reopt-project.git">example”>github.com/TK-23/urbanopt-example-geojson-reopt-project.git“>example</a> project&lt;/StaticLink&gt; for more infomation about usage of this gem.</p>

<p><strong>Note:</strong> this module requires an API Key from the &lt;StaticLink target=&#39;blank&#39; href=“<a href="https://developer.nrel.gov/">NREL”>developer.nrel.gov/“>NREL</a> Developer Network&lt;/StaticLink&gt;.</p>

<p>&lt;StaticLink target=“_blank” href=“<a href="https://urbanopt.github.io/urbanopt-reopt-gem/">RDoc”>urbanopt.github.io/urbanopt-reopt-gem/“>RDoc</a> Documentation&lt;/StaticLink&gt;</p>

<h2 id="label-Installation">Installation<span><a href="#label-Installation">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>See <a href="https://docs.urbanopt.net/installation/installation.html">docs.urbanopt.net/installation/installation.html</a> for instructions on prerequiste software, including: - Ruby 2.2.6 - Bundler 1.17.0 - OpenStudio 2.8.1</p>

<p>Add this line to your application&#39;s Gemfile:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;urbanopt-reopt&#39;</span>
</pre>

<p>And then execute:</p>

<pre>$ bundle install
$ bundle update</pre>

<p>Or install it yourself as:</p>

<pre>$ gem install &#39;urbanopt-reopt&#39;</pre>

<h2 id="label-Functionality">Functionality<span><a href="#label-Functionality">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>This gem is used to call the REopt Lite API on a Scenario Report or Feature Report to update the object&#39;s Distributed Generation attributes (including system financial and sizing metrics) as shown in an example below:</p>

<pre>&quot;distributed_generation&quot;: {
              &quot;lcc_us_dollars&quot;: 100000000.0,
              &quot;npv_us_dollars&quot;: 10000000.0,
              &quot;year_one_energy_cost_us_dollars&quot;: 7000000.0,
              &quot;year_one_demand_cost_us_dollars&quot;: 3000000.0,
              &quot;year_one_bill_us_dollars&quot;: 10000000.0,
              &quot;total_energy_cost_us_dollars&quot;: 70000000.0,
              &quot;solar_pv&quot;: {
                &quot;size_kw&quot;: 30000.0
              },
              &quot;wind&quot;: {
                &quot;size_kw&quot;: 0.0
              },
              &quot;generator&quot;: {
                &quot;size_kw&quot;: 0.0
              },
              &quot;storage&quot;: {
                &quot;size_kw&quot;: 2000.0,
                &quot;size_kwh&quot;: 5000.0
              }
            }</pre>

<p>Moreover, the following optimal dispatch fields are added to its timeseries CSV. Where no system component is recommended the dispatch will be all zero (i.e. if no solar PV is recommended ElectricityProduced:PV:Total will be always be zero)</p>

<pre>|            output                        |  unit   |
| -----------------------------------------| ------- |
| ElectricityProduced:Total                | kWh     |
| Electricity:Load:Total                   | kWh     |
| Electricity:Grid:ToLoad                  | kWh     |
| Electricity:Grid:ToBattery               | kWh     |
| Electricity:Storage:ToLoad               | kWh     |
| Electricity:Storage:ToGrid               | kWh     |
| Electricity:Storage:StateOfCharge        | kWh     |
| ElectricityProduced:Generator:Total      | kWh     |
| ElectricityProduced:Generator:ToBattery  | kWh     |
| ElectricityProduced:Generator:ToLoad     | kWh     |
| ElectricityProduced:Generator:ToGrid     | kWh     |
| ElectricityProduced:PV:Total             | kWh     |
| ElectricityProduced:PV:ToBattery         | kWh     |
| ElectricityProduced:PV:ToLoad            | kWh     |
| ElectricityProduced:PV:ToGrid            | kWh     |
| ElectricityProduced:Wind:Total           | kWh     |
| ElectricityProduced:Wind:ToBattery       | kWh     |
| ElectricityProduced:Wind:ToLoad          | kWh     |
| ElectricityProduced:Wind:ToGrid          | kWh     |</pre>

<p>The REopt Lite has default values for all non-required input parameters that are used unless the user specifies custom assumptions. See &lt;StaticLink target=“_blank” href=“<a href="https://developer.nrel.gov/docs/energy-optimization/reopt-v1/">https://developer.nrel.gov/docs/energy-optimization/reopt-v1/</StaticLink">developer.nrel.gov/docs/energy-optimization/reopt-v1/”>https://developer.nrel.gov/docs/energy-optimization/reopt-v1/</StaticLink</a>&gt; for more detailed information on input parameters and default assumptions.</p>

<p><strong>Note:</strong> Required attributes for a REopt run include latitude and longitude. If no utility rate is specified in your REopt Lite assumption settings, then a constant default rate of $0.13 is assumed without demand charges. Also, by default, only solar PV and storage are considered in the analysis (i.e. Wind and Generators are excluded from consideration).</p>

<h2 id="label-Getting+Started">Getting Started<span><a href="#label-Getting+Started">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The code below shows how to run the REopt API on a single Feature Report hash using this gem:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;urbanopt/reopt&#39;</span>
<span class="ruby-comment">#Load a Feature Report Hash</span>
<span class="ruby-identifier">feature_reports_hash</span> = {} <span class="ruby-comment"># &lt;insert a Feature Report hash here&gt;</span>

<span class="ruby-comment">#Create a Feature Report</span>
<span class="ruby-identifier">feature_report</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">Scenario</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultReports</span><span class="ruby-operator">::</span><span class="ruby-constant">FeatureReport</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">feature_reports_hash</span>)

<span class="ruby-comment">#Specify a file name where REopt Lite results will be written in JSON format</span>
<span class="ruby-identifier">reopt_output_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">feature_report</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-string">&#39;feature_report_reopt_run1.json&#39;</span>)

<span class="ruby-comment">#Specify a file name where the new timeseries CSV will be written after REopt Lite has determined cost optimal dispatch</span>
<span class="ruby-identifier">timeseries_output_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">feature_report</span>.<span class="ruby-identifier">directory_name</span>, <span class="ruby-string">&#39;feature_report_timeseries1.csv&#39;</span>)

<span class="ruby-comment">#Specify non-default REopt Lite assumptions, saved in JSON format, to be used in calling the API</span>
<span class="ruby-identifier">reopt_assumptions_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-string">&#39;../files/reopt_assumptions_basic.json&#39;</span>)

<span class="ruby-comment">#Create a REopt Lite Post Processor to call the API, note you will need a Developer.nrel.gov API key in this step</span>
<span class="ruby-identifier">reopt_post_processor</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REoptPostProcessor</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-constant">DEVELOPER_NREL_KEY</span>)

<span class="ruby-comment">#Call REopt Lite with the post processor to update the feature&#39;s distributed generation attributes and timeseries CSV.</span>
<span class="ruby-identifier">updated_feature_report</span> = <span class="ruby-identifier">reopt_post_processor</span>.<span class="ruby-identifier">run_feature_report</span>(<span class="ruby-identifier">feature_report</span>,<span class="ruby-identifier">reopt_assumptions_file</span>,<span class="ruby-identifier">reopt_output_file</span>,<span class="ruby-identifier">timeseries_output_file</span>)
</pre>

<p>More commonly, this gem can be used to run REopt a collection of features stored in a Scenario Report as show here:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;urbanopt/reopt&#39;</span>
<span class="ruby-comment">#Create a Scenario Report</span>
<span class="ruby-identifier">scenario_report</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">Scenario</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultReports</span><span class="ruby-operator">::</span><span class="ruby-constant">ScenarioReport</span>.<span class="ruby-identifier">new</span>({<span class="ruby-value">:directory_name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-string">&#39;../run/example_scenario&#39;</span>), <span class="ruby-value">:timeseries_csv</span> <span class="ruby-operator">=&gt;</span> {<span class="ruby-value">:path</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-string">&#39;../run/example_scenario/timeseries.csv&#39;</span>) }})

<span class="ruby-comment">#Load Feature Reports into the Scenario Report</span>
(<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">feature_reports_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-node">&quot;../run/example_scenario/#{i}/010_default_feature_reports/default_feature_reports.json&quot;</span>)

  <span class="ruby-identifier">feature_reports_hash</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">feature_reports_path</span>, <span class="ruby-string">&#39;r&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">feature_reports_hash</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>, <span class="ruby-value">symbolize_names:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">feature_report</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">Scenario</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultReports</span><span class="ruby-operator">::</span><span class="ruby-constant">FeatureReport</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">feature_reports_hash</span>)
  
  <span class="ruby-identifier">feature_report_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-node">&quot;../run/example_scenario/#{i}&quot;</span>)
  <span class="ruby-identifier">feature_report</span>.<span class="ruby-identifier">directory_name</span> = <span class="ruby-identifier">feature_report_dir</span>

  <span class="ruby-identifier">scenario_report</span>.<span class="ruby-identifier">add_feature_report</span>(<span class="ruby-identifier">feature_report</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-comment">#Specify non-default REopt Lite assumptions, saved in JSON format, to be used in calling the API</span>
<span class="ruby-identifier">reopt_assumptions_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-string">&#39;../files/reopt_assumptions_basic.json&#39;</span>)

<span class="ruby-comment">#Create a REopt Lite Post Processor to call the API, note you will need a Developer.nrel.gov API key in this step</span>
<span class="ruby-identifier">reopt_post_processor</span> = <span class="ruby-constant">URBANopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REopt</span><span class="ruby-operator">::</span><span class="ruby-constant">REoptPostProcessor</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">scenario_report</span>, <span class="ruby-identifier">reopt_assumptions_file</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-constant">DEVELOPER_NREL_KEY</span>)

<span class="ruby-comment">#Call REopt Lite with the post processor once on the sceanrio&#39;s aggregated load to update the scenario&#39;s distributed generation attributes and timeseries CSV.</span>
<span class="ruby-identifier">updated_scenario_report</span> = <span class="ruby-identifier">reopt_post_processor</span>.<span class="ruby-identifier">run_scenario_report</span>(<span class="ruby-identifier">scenario_report</span>)
</pre>

<h2 id="label-Testing">Testing<span><a href="#label-Testing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>First, check out the repository (i.e. git clone this repo).</p>

<p>Next, obtain a developer.nrel.gov API key from the <a href="https://developer.nrel.gov/">NREL Developer Network</a>]. Copy and paste your key in to the <em>developer_nrel_key</em>.<em>rb</em> file then save the file:</p>

<pre class="ruby"><span class="ruby-constant">DEVELOPER_NREL_KEY</span> = <span class="ruby-string">&#39;&lt;insert your key here&gt;&#39;</span>
</pre>

<p>Finally, execute:</p>

<pre>$ bundle install
$ bundle update    
$ bundle exec rake</pre>

<h2 id="label-Releasing">Releasing<span><a href="#label-Releasing">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p>Update change log</p>
</li><li>
<p>Update version in <code>/lib/urbanopt/reopt/version.rb</code></p>
</li><li>
<p>Merge down to master</p>
</li><li>
<p>run <code>rake release</code> from master</p>
</li></ul>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

